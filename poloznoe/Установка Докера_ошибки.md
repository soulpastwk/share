# Решение ошибки `permission denied while trying to connect to the Docker daemon socket`

Ошибка `permission denied while trying to connect to the Docker daemon socket` указывает на то, что пользователь `newuser` не имеет прав доступа к сокету Docker (`/var/run/docker.sock`). Это может происходить по нескольким причинам. Давайте разберёмся и исправим проблему.

---

## 1. **Проверьте, добавлен ли пользователь в группу `docker`**

Убедитесь, что пользователь `newuser` действительно добавлен в группу `docker`. Выполните команду:

```bash
groups newuser
```

В выводе должна быть группа `docker`. Если её нет, выполните следующую команду для добавления пользователя в группу:

```bash
sudo usermod -aG docker newuser
```

> **Примечание:** Флаг `-aG` означает, что пользователь будет добавлен в указанную группу (`docker`) без удаления из других групп.

---

## 2. **Перезапустите сессию пользователя**

После добавления пользователя в группу необходимо перезапустить сессию пользователя, чтобы изменения вступили в силу. Вы уже выполнили команду `newgrp docker`, но это временно меняет группу только для текущей сессии. Чтобы изменения применились глобально, нужно выйти из системы и войти снова.

Выполните:

```bash
exit
```

Затем войдите снова под пользователем `newuser`.

> **Примечание:** Перезапуск сессии важен, так как изменения групп применяются только после нового входа в систему.

---

## 3. **Проверьте права на сокет Docker**

Убедитесь, что сокет Docker (`/var/run/docker.sock`) имеет правильные права доступа:

```bash
ls -l /var/run/docker.sock
```

Ожидаемый вывод:

```
srw-rw---- 1 root docker 0 Oct 10 12:34 /var/run/docker.sock
```

Здесь:
- Владелец: `root`
- Группа: `docker`
- Права: `rw-rw----` (чтение и запись для владельца и группы)

Если группа отличается от `docker`, измените её:

```bash
sudo chown root:docker /var/run/docker.sock
```

Если права доступа некорректны, установите их:

```bash
sudo chmod 660 /var/run/docker.sock
```

> **Примечание:** Права `660` позволяют владельцу и группе читать и писать в сокет, а остальным пользователям доступ запрещён.

---

## 4. **Перезапустите службу Docker**

Иногда изменения прав или группы требуют перезапуска службы Docker:

```bash
sudo systemctl restart docker
```

> **Примечание:** После перезапуска службы Docker убедитесь, что она работает корректно с помощью команды `systemctl status docker`.

---

## 5. **Проверьте работу Docker**

Теперь попробуйте снова запустить тестовый контейнер:

```bash
docker run hello-world
```

Если всё настроено правильно, вы увидите сообщение:

```
Hello from Docker!
This message shows that your installation appears to be working correctly.
```

---

## 6. **Альтернативное решение: использование `sudo`**

Если вы не хотите добавлять пользователя в группу `docker` (например, из соображений безопасности), вы можете запускать Docker с правами `sudo`:

```bash
sudo docker run hello-world
```

Однако это менее удобно, так как требует постоянного использования `sudo`.

> **Примечание:** Использование `sudo` снижает риск случайного повреждения системы, но может быть неудобным для частого использования Docker.

---

## 7. **Дополнительная проверка SELinux/AppArmor**

Если вы используете систему с включённым SELinux или AppArmor, они могут блокировать доступ к сокету Docker. В этом случае проверьте логи:

```bash
journalctl -xe
```

Или временно отключите SELinux/AppArmor для тестирования:

```bash
sudo setenforce 0  # Для SELinux
```

> **Важно:** Отключение SELinux или AppArmor может снизить безопасность системы, поэтому рекомендуется использовать этот метод только для диагностики.

---

## Заключение

После выполнения всех шагов пользователь `newuser` должен получить доступ к Docker без ошибок. Если проблема всё ещё остаётся, проверьте конфигурацию Docker и логи системы для дополнительной диагностики.

> **Совет:** Регулярно обновляйте Docker до последней версии, чтобы избежать возможных проблем совместимости и безопасности.

```
