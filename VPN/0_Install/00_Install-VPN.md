# üõ°Ô∏è –°–≤–æ–π VPN-—Å–µ—Ä–≤–µ—Ä ( Ubuntu 24 + 3X-UI )

[![OS Linux](https://img.shields.io/badge/OS-Linux-blue?logo=linux&logoColor=white)](https://www.linux.org/)
[![OpenSSL](https://img.shields.io/badge/OpenSSL-%E2%9C%94-green?logo=openssl&logoColor=white)](https://www.openssl.org/)
[![Xray](https://img.shields.io/badge/Xray-Ready-orange?logo=github)](https://github.com/XTLS/Xray-core)
[![License](https://img.shields.io/badge/License-MIT-purple)](LICENSE)

====== ‚Üë ‚Üë ‚Üë –ö–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ —à—Ç—É–∫–∏ ‚Üë ‚Üë ‚Üë ======
> [!IMPORTANT]
> –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–∏—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –≤ –Ω–µ–∑–∞–∫–æ–Ω–Ω—ã—Ö —Ü–µ–ª—è—Ö –∏ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ä–µ–¥–µ.
> 
## üîë –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ª–æ–≥–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. –û–±–Ω–æ–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º—É –∏ —Å—Ç–∞–≤–∏–º –±–∞–∑–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã.
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º **3X-UI + —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** (–ø–æ–ª—É—á–∞–µ–º –≤–µ–±-–ø–æ—Ä—Ç –ø–∞–Ω–µ–ª–∏ –∏ –ø–æ—Ä—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤).
3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º **SSH** (—Å–º–µ–Ω–∞ –ø–æ—Ä—Ç–∞, –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ).
4. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º **Fail2Ban** (—Å —É—á—ë—Ç–æ–º —É–∂–µ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤).
5. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ñ–∞–µ—Ä–≤–æ–ª (**nftables**) –ø–æ–¥ —ç—Ç–∏ –ø–æ—Ä—Ç—ã.
6. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –ª–æ–≥–∏ (**systemd-journal**, Fail2Ban) –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã **ICMP/sysctl**.
7. –ß–∏—Å—Ç–∏–º —Å–∏—Å—Ç–µ–º—É: —É–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—ã–µ —è–¥—Ä–∞ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–∫–ª—é—á–∞–µ–º **IPv6**.

---

## üåç –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã VPS

* [hshp.host](https://hshp.host/) ‚Äî –æ—Ç–ª–∏—á–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ —Ä–µ—Å—É—Ä—Å—ã —Å–µ—Ä–≤–µ—Ä–∞
  
  **300 ‚ÇΩ** ‚Üí 1 CPU / 2 –ì–ë RAM / 30 –ì–ë NVMe / 500 –ú–±–∏—Ç –∫–∞–Ω–∞–ª / –±–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫.
  
* [hostkey.ru](https://hostkey.ru/) ‚Äî –¥—Ä—É–≥–∏–µ —Ç–∞—Ä–∏—Ñ—ã:

  * VPS / 1 vCPU / 1 –ì–ë RAM / 15 –ì–ë SSD ‚Äî **255 ‚ÇΩ**
  * VPS / 2 vCPU / 2 –ì–ë RAM / 30 –ì–ë SSD ‚Äî **350 ‚ÇΩ**
  * –¢—Ä–∞—Ñ–∏–∫: 3 –¢–ë/–º–µ—Å.
    
* [cloudzy.com](https://cloudzy.com/) ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–ø–ª–∞—Ç—ã –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ–π, –Ω–æ —Ü–µ–Ω–∞ –≤—ã—à–µ (\~**7,5 üí≤**).
* –ß–∏—Å—Ç–æ –∑–∞—Ä—É–±–µ–∂–Ω—ã–π —Å–µ—Ä–≤–∏—Å –∏ –Ω–µ –∑–∞–±—ã–≤–∞–µ–º +1 üí≤ –∫–æ–º–º–∏—Å–∏—è, –µ—Å–ª–∏ –æ–ø–ª–∞—Ç–∞ –≤ –∫—Ä–∏–ø—Ç–µ.

  * –ï–≤—Ä–æ–ø–∞  \~**7,5 üí≤**
  * –ê–º–µ—Ä–∏–∫–∞  \~**5,5 üí≤**
  * –ú–æ—â–Ω–æ—Å—Ç–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º—ã–µ —Å –≤—ã—à–µ—É–∫–∞–∑–∞–Ω–Ω—ã–º–∏, —Ç—Ä–∞—Ñ–∏–∫ ‚Äî 1 –¢–ë/–º–µ—Å, —á–µ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è VPN-—Å–µ—Ä–≤–µ—Ä–∞.

---
# üõ° –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –∑–∞—â–∏—Ç–µ VPN-—Å–µ—Ä–≤–µ—Ä–∞
---

## üîÑ 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤

```bash
apt update && apt upgrade -y && apt dist-upgrade -y
apt install -y nano mc htop lsof iperf3 curl dos2unix openssl systemd fail2ban
```

**–î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω—ã –ø–∞–∫–µ—Ç—ã:**

* **nano/mc** ‚Äì —É–¥–æ–±–Ω—ã–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏ —Ñ–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä.
* **htop/lsof** ‚Äì –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.
* **iperf3** ‚Äì –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
* **curl** ‚Äì —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤.
* **dos2unix** ‚Äì –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ —Å—Ç—Ä–æ–∫ –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö.
* **openssl** ‚Äì –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.
* **systemd** ‚Äì —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏.
* **fail2ban** - –∑–∞—â–∏—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ –æ—Ç –ø–µ—Ä–µ–±–æ—Ä–∞ –ø–∞—Ä–æ–ª–µ–π.

‚ö†Ô∏è iperf3 - –º–æ–∂–Ω–æ –Ω–µ —Å—Ç–∞–≤–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—Å–∫–∞–¥–Ω—ã–π VPN –∏–∑ –¥–≤—É—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤

---

## üöÄ 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ 3X-UI

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 3X-UI —Å –ø–∞–Ω–µ–ª—å—é –∏ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ –Ω–∞ 10 –ª–µ—Ç:

```bash
curl -fsSL -o ~/00_–°ert_VPN_stable_version.sh https://raw.githubusercontent.com/soulpastwk/share/main/VPN/0_Install/00_–°ert_VPN_stable_version.sh \
&& dos2unix ~/00_–°ert_VPN_stable_version.sh 2>/dev/null || true \
&& chmod +x ~/00_–°ert_VPN_stable_version.sh \
&& bash ~/00_–°ert_VPN_stable_version.sh
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:

1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `openssl` –∏ `x-ui`.
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç **3X-UI**.
3. –°–æ–∑–¥–∞—ë—Ç —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å –º–∞—Å–∫–∏—Ä–æ–≤–∫–æ–π –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å (Google, Yandex, –∏ –¥—Ä.).
  * (Yandex - –¥–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ –†–æ—Å—Å–∏–∏ / Google - –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö)
  * –°–µ—Ä–≤–µ—Ä –≤ –†–æ—Å—Å–∏–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –Ω–∞–º —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ VPN, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å–∞–Ω –æ—Ç–¥–µ–ª—å–Ω–æ –±—É–¥–µ—Ç.
5. –í–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø–∞–Ω–µ–ª–∏.
6. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–ª–æ–≥–∏–Ω, –ø–∞—Ä–æ–ª—å –∏ –ø–æ—Ä—Ç –ø–∞–Ω–µ–ª–∏ (—Å–ª—É—á–∞–π–Ω—ã–π)**.

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ø–æ—Ä—Ç—ã –≤–µ–±-–ø–∞–Ω–µ–ª–∏ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∏–∑–≤–µ—Å—Ç–Ω—ã —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏.
–ó–∞–ø–æ–º–Ω–∏—Ç–µ –∏—Ö ‚Äî –æ–Ω–∏ –Ω—É–∂–Ω—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–µ—Ä–≤–æ–ª–∞.

---

## üîí 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH

–ò–∑–º–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```bash
nano /etc/ssh/sshd_config
```

–ü—Ä–∏–º–µ—Ä:

```ini
Port 60022        # –≤—ã–±–∏—Ä–∞–µ–º –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç (60000‚Äì65000)
PermitRootLogin no
PasswordAuthentication no   # –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–ª—é—á–µ–π
Banner none
PrintMotd no
DebianBanner no
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫:

```bash
systemctl restart ssh
```

*–ó–∞—á–µ–º:* —É–º–µ–Ω—å—à–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∞—Ç–∞–∫ –Ω–∞ SSH.

---

## üõ° 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Fail2Ban

–°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ñ–∏–≥:

```bash
nano /etc/fail2ban/jail.local
```

–ü—Ä–∏–º–µ—Ä –¥–ª—è SSH:

```ini
[sshd]
enabled = true
filter = sshd
action = nftables[name=SSH, port=ssh, protocol=tcp]
logpath = %(syslog_authpriv)s
findtime = 600
maxretry = 2
bantime = -1
backend = systemd
```

### üìñ –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

* **enabled = true** ‚Äî –≤–∫–ª—é—á–∞–µ—Ç –∑–∞—â–∏—Ç—É –¥–ª—è —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.
* **filter = sshd** ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–æ–π —Ñ–∏–ª—å—Ç—Ä (—à–∞–±–ª–æ–Ω –ø–æ–∏—Å–∫–∞ –≤ –ª–æ–≥–∞—Ö) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.
* **action = nftables\[name=SSH, port=ssh, protocol=tcp]** ‚Äî –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ –±–∞–Ω–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª–æ –≤ `nftables`, –∑–∞–∫—Ä—ã–≤–∞—é—â–µ–µ –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç—É SSH.
* **logpath = %(syslog\_authpriv)s** ‚Äî –ø—É—Ç—å –¥–æ –ª–æ–≥–æ–≤ (–≤ Ubuntu 24.04 —á–µ—Ä–µ–∑ systemd-journald –º–∞–ø–ø–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).
* **findtime = 600** ‚Äî –∑–∞ –∫–∞–∫–æ–π –ø–µ—Ä–∏–æ–¥ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö, –∑–¥–µ—Å—å 10 –º–∏–Ω—É—Ç) —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞.
* **maxretry = 2** ‚Äî —Å–∫–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–µ–∂–¥–µ —á–µ–º IP –±—É–¥–µ—Ç –∑–∞–±–∞–Ω–µ–Ω.
* **bantime = -1** ‚Äî –≤—Ä–µ–º—è –±–∞–Ω–∞: `-1` –∑–Ω–∞—á–∏—Ç **–ø–æ–∂–∏–∑–Ω–µ–Ω–Ω–æ** (IP –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ –±–∞–Ω–µ, –ø–æ–∫–∞ –∞–¥–º–∏–Ω –≤—Ä—É—á–Ω—É—é –Ω–µ —Å–Ω–∏–º–µ—Ç).
* **backend = systemd** ‚Äî Fail2Ban –ø–æ–ª—É—á–∞–µ—Ç –ª–æ–≥–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ systemd-journald (–ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è Ubuntu 24).

---

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –≤ —Å–∞–º–∏—Ö –∫–æ–Ω—Ñ–∏–≥-—Ñ–∞–π–ª–∞—Ö (`jail.local`) –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Å–µ–∫—Ü–∏–∏ **–ø–∏—Å–∞—Ç—å –Ω–µ–ª—å–∑—è** ‚Äî Fail2Ban –Ω–µ –ø—Ä–∏–º–µ—Ç —Ç–∞–∫–æ–π —Ñ–∞–π–ª –∏ —Å–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è.
–ï—Å–ª–∏ –Ω—É–∂–Ω—ã –ø–æ—è—Å–Ω–µ–Ω–∏—è ‚Äî –ª—É—á—à–µ –æ—Å—Ç–∞–≤–ª—è—Ç—å –∏—Ö –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–ª–∏ –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ **–ø–µ—Ä–µ–¥ —Å–µ–∫—Ü–∏—è–º–∏**.

–ó–∞–ø—É—Å–∫:

```bash
systemctl enable fail2ban
systemctl restart fail2ban
```

---

## üî• 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–µ—Ä–≤–æ–ª–∞ (nftables)

‚ö†Ô∏è –ü–µ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ **–ø–æ—Ä—Ç SSH** –∏ **–ø–æ—Ä—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 3X-UI** –¥–ª—è –í–µ–±-–∫–∏ –∏ 443 (–∏–ª–∏ 8433 –µ—Å–ª–∏ –∫–∞—Å–∫–∞–¥–Ω—ã–π VPN)

–§–∞–π–ª `/etc/nftables.conf`:

```nft
#!/usr/sbin/nft -f

flush ruleset

table inet filter {
    chain input {
        type filter hook input priority 0;
        policy drop;

        # Loopback
        iif lo accept

        # –£–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        ct state established,related accept

        # SSH (—É–∫–∞–∂–∏—Ç–µ —Å–≤–æ–π –ø–æ—Ä—Ç)
        tcp dport 60022 accept

        # –ü–æ—Ä—Ç—ã –ø–∞–Ω–µ–ª–∏ 3X-UI (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ)
        tcp dport 8443 accept
        tcp dport 60555 accept

        # –ü—Ä–∏–º–µ—Ä: iperf3 —Ç–æ–ª—å–∫–æ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ IP
        ip saddr 192.168.1.1 tcp dport 5201 accept

    }

    chain forward {
        type filter hook forward priority 0;
        policy drop;
    }

    chain output {
        type filter hook output priority 0;
        policy accept;
    }
}
```

–ü—Ä–∏–º–µ–Ω—è–µ–º:

```bash
systemctl enable nftables
systemctl restart nftables
nft list ruleset
```

---

## ‚ö° 6. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ª–æ–≥–æ–≤ (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–∫–µ)

### üìå –í–∞—Ä–∏–∞–Ω—Ç 1: —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ RAM

```ini
[Journal]
Storage=volatile
RuntimeMaxUse=50M
SystemMaxUse=0
```

* –õ–æ–≥–∏ –æ—á–∏—â–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ.
* Fail2Ban: –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ ¬´–∏—Å—Ç–æ—Ä–∏—è¬ª –∞—Ç–∞–∫ –æ–±–Ω—É–ª—è–µ—Ç—Å—è. –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤, —Ç.–∫. –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –Ω–æ–≤—ã–µ –∞—Ç–∞–∫–∏ —Å–Ω–æ–≤–∞ –±—É–¥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è.
* –õ–æ–≥–∏ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤ /run/log/journal/ (–≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏).
* –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ –∑–∞–ø–∏—Å–∏ –æ—á–∏—â–∞—é—Ç—Å—è.

---

### üìå –í–∞—Ä–∏–∞–Ω—Ç 2: —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫–µ

```ini
[Journal]
Storage=persistent
SystemMaxUse=500M
RuntimeMaxUse=50M
```

* –õ–æ–≥–∏ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –ø—Ä–∏–≤—ã—á–Ω–æ–º –º–µ—Å—Ç–µ /var/log/journal/ –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.
* Fail2Ban: —Å–º–æ–∂–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –∞—Ç–∞–∫, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Å –º–æ–º–µ–Ω—Ç–∞ —Å—Ç–∞—Ä—Ç–∞ —Å–∏—Å—Ç–µ–º—ã.
* –ú–∏–Ω—É—Å: –±–æ–ª—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –¥–∏—Å–∫ (–æ—Å–æ–±–µ–Ω–Ω–æ SSD/VPS —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–æ–º), –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ.

---

## üåê 7. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ IPv6 –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç ICMP

### –ü–æ—á–µ–º—É –æ—Ç–∫–ª—é—á–∞–µ–º IPv6?

* –ú–Ω–æ–≥–∏–µ VPN –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–æ–ª—å–∫–æ IPv4.
* –ï—Å–ª–∏ IPv6 –æ—Å—Ç–∞–≤–∏—Ç—å –≤–∫–ª—é—á—ë–Ω–Ω—ã–º, –≤–æ–∑–º–æ–∂–Ω—ã **—É—Ç–µ—á–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ IP —á–µ—Ä–µ–∑ DNS –∏–ª–∏ –ø—Ä—è–º—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**, —á—Ç–æ –º–æ–∂–µ—Ç ¬´–≤—ã–¥–∞—Ç—å¬ª –≤–∞—Å.

–û—Ç–∫–ª—é—á–µ–Ω–∏–µ:

```bash
echo "GRUB_CMDLINE_LINUX=\"ipv6.disable=1\"" | tee -a /etc/default/grub
update-grub
reboot
```
---

## üîí –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ ICMP

–ß—Ç–æ–±—ã —É—Å–ª–æ–∂–Ω–∏—Ç—å —Å–µ—Ç–µ–≤—ã–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∑–∞—â–∏—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:

```bash
# –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ /etc/sysctl.conf
echo "net.ipv4.icmp_echo_ignore_all = 1" >> /etc/sysctl.conf
echo "net.ipv4.icmp_echo_ignore_broadcasts = 1" >> /etc/sysctl.conf
echo "net.ipv4.icmp_ignore_bogus_error_responses = 1" >> /etc/sysctl.conf

# –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
sysctl -p
```

## üìä –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

```
ICMP –ø–∞–∫–µ—Ç—ã
‚îú‚îÄ‚îÄ Echo Request (ping)
‚îÇ   ‚îî‚îÄ net.ipv4.icmp_echo_ignore_all = 1  ‚úÖ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è –≤—Å–µ ping-–∑–∞–ø—Ä–æ—Å—ã
‚îú‚îÄ‚îÄ Broadcast Echo Request (ping –Ω–∞ —à–∏—Ä–æ–∫–æ–≤–µ—â–∞—Ç–µ–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å)
‚îÇ   ‚îî‚îÄ net.ipv4.icmp_echo_ignore_broadcasts = 1  ‚úÖ –∑–∞—â–∏—Ç–∞ –æ—Ç Smurf-–∞—Ç–∞–∫
‚îî‚îÄ‚îÄ –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ ICMP –æ—à–∏–±–∫–∏ (bogus/error)
    ‚îî‚îÄ net.ipv4.icmp_ignore_bogus_error_responses = 1  ‚úÖ –∏–≥–Ω–æ—Ä –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∏–ª–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã—Ö ICMP-–ø–∞–∫–µ—Ç–æ–≤
```

### üîπ –ü–æ—è—Å–Ω–µ–Ω–∏—è

* `icmp_echo_ignore_all` ‚Üí –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–±—ã—á–Ω—ã–µ ping-–∑–∞–ø—Ä–æ—Å—ã.
* `icmp_echo_ignore_broadcasts` ‚Üí –æ—Ç–¥–µ–ª—å–Ω–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —à–∏—Ä–æ–∫–æ–≤–µ—â–∞—Ç–µ–ª—å–Ω—ã—Ö ping (Smurf).
* `icmp_ignore_bogus_error_responses` ‚Üí –±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ/–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ ICMP —Å–æ–æ–±—â–µ–Ω–∏—è.

‚ö†Ô∏è **–í—ã–≤–æ–¥:** –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞—â–∏—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞ –æ—Ç ICMP-—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∞—Ç–∞–∫ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–≤—Å–µ —Ç—Ä–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤–º–µ—Å—Ç–µ**.

---

### 1Ô∏è‚É£ `net.ipv4.icmp_echo_ignore_all = 1`

* –ü–æ–ª–Ω–æ—Å—Ç—å—é **–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –≤—Å–µ ICMP echo-–∑–∞–ø—Ä–æ—Å—ã** (`ping`).
* –°–µ—Ä–≤–µ—Ä **–Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `ping`** –Ω–∏ –æ—Ç –∫–æ–≥–æ.
* **–í–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ ICMP —Ç–∏–ø–∞ Echo Request**.

---

### 2Ô∏è‚É£ `net.ipv4.icmp_echo_ignore_broadcasts = 1`

* –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç **ping –Ω–∞ broadcast-–∞–¥—Ä–µ—Å–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, 192.168.1.255).
* –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç **Smurf-–∞—Ç–∞–∫** (–∫–æ–≥–¥–∞ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ —à–ª—ë—Ç ping –Ω–∞ —à–∏—Ä–æ–∫–æ–≤–µ—â–∞—Ç–µ–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å, —á—Ç–æ–±—ã –Ω–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ç—å).
* **–ù–µ –¥—É–±–ª–∏—Ä—É–µ—Ç `icmp_echo_ignore_all`**, —Ç.–∫. broadcast –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ `icmp_echo_ignore_all` –æ—Ç–∫–ª—é—á–µ–Ω (`0`).

---

### 3Ô∏è‚É£ `net.ipv4.icmp_ignore_bogus_error_responses = 1`

* –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç **–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ ICMP –æ—à–∏–±–∫–∏**, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –∞—Ç–∞–∫ –∏–ª–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.
* –ü—Ä–∏–º–µ—Ä—ã: ICMP Destination Unreachable —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º, ICMP Redirect, ICMP Parameter Problem.
* **–ù–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ Echo Request**, –ø–æ—ç—Ç–æ–º—É –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç –ø–µ—Ä–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ.

---

## ‚ö†Ô∏è –¢–ê–ö –ñ–ï –í–ê–ñ–ù–û: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞ `sudo`

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç **sudo** –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏.
–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–∞–∫ –∂–µ –≤ –º–æ—ë–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ: [–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ sudo](https://github.com/soulpastwk/share/blob/main/VPN/0_Install/01_Update_Sudo.md)

### ‚ùó –ü—Ä–∏—á–∏–Ω–∞

–í –≤–µ—Ä—Å–∏—è—Ö **sudo –¥–æ 1.9.17p2** –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å (**CVE-2025-32463**):

* –õ—é–±–æ–π –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–¥ —Å –ø—Ä–∞–≤–∞–º–∏ **root**,
* –î–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–Ω–µ —É–ø–æ–º—è–Ω—É—Ç –≤ sudoers**.

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞ –ø–µ—Ä–µ–¥ –¥–∞–ª—å–Ω–µ–π—à–µ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π.

---

‚úÖ –¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä:

* –û–±–Ω–æ–≤–ª—ë–Ω –∏ –∑–∞—â–∏—â—ë–Ω,
* –†–∞–±–æ—Ç–∞–µ—Ç —Å **3X-UI –ø–∞–Ω–µ–ª—å—é –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏**,
* –° –Ω–∞–¥—ë–∂–Ω—ã–º **—Ñ–∞–µ—Ä–≤–æ–ª–æ–º (nftables)**,
* –° –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏,
* –° –æ—Ç–∫–ª—é—á—ë–Ω–Ω—ã–º IPv6 (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–µ–∫).

---

