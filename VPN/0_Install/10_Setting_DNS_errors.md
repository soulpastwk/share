# ‚ö° –í–æ–∑–º–æ–∂–Ω–∞ –æ—à–∏–±–∫–∞ `ifdown: unknown interface ens1` –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å Netplan

> \[!IMPORTANT]
> –î–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ –≤—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–µ—Ä–µ–∑ `ifup/ifdown`,
> –Ω–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –ø—Ä–æ–ø–∏—Å–∞–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö **/etc/network/interfaces** –∏–ª–∏ **/etc/network/interfaces.d/**.
> –£—Ç–∏–ª–∏—Ç—ã `ifup` –∏ `ifdown` —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏, –æ–ø–∏—Å–∞–Ω–Ω—ã–º–∏ –≤ —ç—Ç–∏—Ö –∫–æ–Ω—Ñ–∏–≥-—Ñ–∞–π–ª–∞—Ö.
>
> ‚ö†Ô∏è –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ **Netplan**, –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∑–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ç—å—é, –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `netplan generate` –∏ `netplan apply`.

---

## üîç –°–∏–º–ø—Ç–æ–º—ã

```bash
sudo ifdown --force ens1 && sudo ifup ens1
ifdown: unknown interface ens1
```

–ü—Ä–∏ —ç—Ç–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∏–¥–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ:

```bash
ip -c -br a
lo               UNKNOWN        127.0.0.1/8
ens1             UP             45.211.246.16/24
```

---

## üîß –†–µ—à–µ–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤ ifupdown (–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ—Å—Ç—ã–ª—å)

```bash
grep -R ens1 /etc/network/interfaces*
```

–ï—Å–ª–∏ –≤—ã–≤–æ–¥–∞ –Ω–µ—Ç ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –ø—Ä–æ–ø–∏—Å–∞–Ω. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ:

```bash
nano /etc/network/interfaces
```

```ini
auto ens1
iface ens1 inet static
    address 45.211.246.16
    netmask 255.255.255.0
    gateway 45.211.246.1
    dns-nameservers 94.140.14.14 94.140.15.15
```

> \[!TIP]
> –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–¥–Ω—è—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –í –¥–∞–ª—å–Ω–µ–π—à–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∑–º ‚Äî Netplan.

---

### 2. –ü–æ–¥–Ω—è—Ç–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —á–µ—Ä–µ–∑ Netplan (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
sudo netplan generate
sudo netplan apply
```

–ü—Ä–æ–≤–µ—Ä—è–µ–º:

```bash
ip -c -br a show ens1
ip route
resolvectl status | grep 'DNS Servers' -A2
ping -c 4 8.8.8.8
```

> \[!TIP]
> –ü–æ—Å–ª–µ `netplan apply` IP, –º–∞—Ä—à—Ä—É—Ç—ã –∏ DNS –±—É–¥—É—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–Ω—Ñ–∏–≥—É `/etc/netplan/*.yaml`.

---

### 3. –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä—É—á–Ω–æ–µ –ø–æ–¥–Ω—è—Ç–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –±–µ–∑ ifupdown

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ¬´–Ω–∞ –ª–µ—Ç—É¬ª, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫:

```bash
sudo ip link set ens1 up
sudo ip addr flush dev ens1
sudo ip addr add 45.211.246.16/24 dev ens1
sudo ip route add default via 45.211.246.1
```

> ‚ö†Ô∏è –≠—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è **–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏**. –î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Netplan.

---

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

### Warning: LLMNR

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –º–æ–∂–µ—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è:

```
Setting LLMNR support level "yes" for "2", but the global support level is "no".
```

* –≠—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞.
* –õ–∏—à–Ω–µ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ systemd-resolved –æ —Ç–æ–º, —á—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω–æ –æ—Ç–∫–ª—é—á—ë–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª **LLMNR** (–ª–æ–∫–∞–ª—å–Ω—ã–π –º—É–ª—å—Ç–∏–∫–∞—Å—Ç —Ä–µ–∑–æ–ª–≤ –∏–º—ë–Ω).
* –ù–∞ —Ä–∞–±–æ—Ç—É —Å–µ—Ç–∏ –∏ VPN –Ω–µ –≤–ª–∏—è–µ—Ç.

---

## ‚úÖ –ò—Ç–æ–≥

* `ifup/ifdown` ‚Üí –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ—Å—Ç—ã–ª—å, —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–ª–∏ —Ä—É—á–Ω–æ–≥–æ –ø–æ–¥–Ω—è—Ç–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
* –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ç—å—é ‚Äî —á–µ—Ä–µ–∑ **Netplan** (`netplan generate/apply`).
* –†—É—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ `ip addr/route` ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞, –µ—Å–ª–∏ –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ Netplan.


# üìå –ö–∞–∫ —É–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–π DNS (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1.1.1.1`) –≤ Ubuntu/Debian —Å Netplan + systemd-resolved

–ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–µ—Ç–µ–π —á–µ—Ä–µ–∑ **Netplan + systemd-resolved** –º–æ–∂–µ—Ç –≤–Ω–µ–∑–∞–ø–Ω–æ –ø–æ—è–≤–ª—è—Ç—å—Å—è –ª–∏—à–Ω–∏–π DNS (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1.1.1.1`), –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω –Ω–∏ –≤ `/etc/netplan/*.yaml`, –Ω–∏ –≤ `/etc/systemd/resolved.conf`.

–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑-–∑–∞:

* üóÇÔ∏è —Å—Ç–∞—Ä—ã—Ö **DHCP lease**, —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö systemd-networkd/NetworkManager;
* üåÄ –∫–æ–Ω—Ñ–∏–≥–æ–≤ cloud-init –∏–ª–∏ `*.network` —Ñ–∞–π–ª–æ–≤ systemd, –≥–¥–µ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è DNS.

---

## üîç –®–∞–≥ 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ DNS

```bash
resolvectl status | grep 'DNS Servers' -A2
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:

```
DNS Servers: 30.50.90.50
Fallback DNS Servers: 94.140.14.14 94.140.15.15

Link 2 (eth0)
       DNS Servers: 1.1.1.1   üëà –õ–∏—à–Ω–∏–π
```

‚Äî –∑–Ω–∞—á–∏—Ç, –ø—Ä–æ–±–ª–µ–º–∞ –∏–º–µ–Ω–Ω–æ –≤ lease –∏–ª–∏ –≤ `.network`-—Ñ–∞–π–ª–∞—Ö.

---

## üóëÔ∏è –®–∞–≥ 2. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ DHCP lease

```bash
rm -f /var/lib/systemd/network/*.lease
rm -f /var/lib/NetworkManager/*lease
```

---

## üîÑ –®–∞–≥ 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ç–µ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã

```bash
systemctl restart systemd-networkd
systemctl restart systemd-resolved
```

---

## üìù –®–∞–≥ 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```bash
resolvectl status | grep 'DNS Servers' -A2
```

–¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤–∞—à DNS (–Ω–∞–ø—Ä–∏–º–µ—Ä, `94.140.15.15` –∏ `94.140.14.14`).

---

## üõ°Ô∏è –®–∞–≥ 5. –ï—Å–ª–∏ `1.1.1.1` –≤—Å—ë –µ—â—ë –ø–æ—è–≤–ª—è–µ—Ç—Å—è

–°–æ–∑–¥–∞—ë–º drop-in –¥–ª—è systemd-networkd:

```bash
nano /etc/systemd/network/10-eth0.network
```

–ü—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç—Ä–æ–≥–æ —Å–≤–æ–∏ DNS:

```ini
[Match]
Name=eth0

[Network]
DNS=94.140.15.15
DNS=94.140.14.14
Domains=~.
```

–ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```bash
systemctl restart systemd-networkd systemd-resolved
```

---

## ‚úÖ –ò—Ç–æ–≥

–ü–æ—Å–ª–µ —ç—Ç–∏—Ö —à–∞–≥–æ–≤ `resolvectl status` –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ DNS, —á—Ç–æ –≤—ã –∑–∞–¥–∞–ª–∏ –≤—Ä—É—á–Ω—É—é. –ù–∏–∫–∞–∫–æ–≥–æ Cloudflare `1.1.1.1` ‚ú®

---


