# 🚀 Каскадный VPN на базе 3X-UI (XRAY VLESS)

[![xray-core](https://img.shields.io/badge/xray--core-1.8.23-brightgreen?style=flat-square&logo=vercel)](https://github.com/XTLS/Xray-core)
[![protocol](https://img.shields.io/badge/protocol-VLESS-blue?style=flat-square)](https://xtls.github.io/)
![Platform](https://img.shields.io/badge/platform-Linux-lightgrey?style=flat-square&logo=linux)
![Tested on](https://img.shields.io/badge/tested%20on-Ubuntu%2024.04%20%7C%20Debian%2012-orange?style=flat-square)
![VPN](https://img.shields.io/badge/VPN-Cascading%20Setup-important?style=flat-square)

---
> [!IMPORTANT]
> Этот проект предназначен только для личного использования, пожалуйста, не используйте его в незаконных целях и в производственной среде.
> ⚠️ Дисклеймер ⚠️
> > Данный материал создан **исключительно в образовательных целях**.  
> Автор не несёт ответственности за возможные последствия использования.  
> Применяйте только в рамках законного тестирования и легальных задач.

---

## 📌 Введение
Каскадный VPN — это схема, в которой клиент подключается к **первому серверу** (например, в России), а трафик с него перенаправляется на **второй сервер** (за пределами РФ).  
Таким образом, провайдер видит лишь подключение к первому серверу, а реальный выход в Интернет осуществляется через второй сервер.

---

## 🛠 Этап 1. Настройка первого VPS (Москва, маскировка `yandex.ru`)

Устанавливаем **3X-UI** и **XRAY** согласно инструкции:  
👉 [00_Install-VPN.md](https://github.com/soulpastwk/share/blob/main/VPN/0_Install/00_Install-VPN.md)

После установки создаём **VLESS соединение**:

- **Порт IP:** `8443`  
- **Dest:** `yandex.ru:443`  
- **SNI:** `yandex.ru,www.yandex.ru`  
- **Sniffing:** ✅ включен  
- **Сертификат:** нажимаем `Get New Cert` (создаст публичный и приватный ключи)  
- **Seed:** ⚠️ **НЕ НАЖИМАТЬ** кнопку `Get New Seed` (оставить пустым)

---

## 🛠 Этап 2. Настройка второго VPS (Европа, маскировка `google.com`)

На сервере в Европе (Германия/Нидерланды/Финляндия) создаём **VLESS соединение**:

- **Порт IP:** `443`  
- **Dest:** `google.com:443`  
- **SNI:** `google.com,www.google.com`  
- **Sniffing:** ✅ включен  
- **Сертификат:** нажимаем `Get New Cert`  
- **Seed:** ⚠️ **НЕ НАЖИМАТЬ** кнопку `Get New Seed`

---

## 🛠 Этап 3. Создание маршрутизации на первом VPS (Москва)

1. Получаем **ключ VLESS** от второго (европейского) сервера.  
2. Заходим в панель управления **3X-UI** на московском VPS.  
3. Переходим в раздел:  
   **Настройки Xray → Аутбаунды → Создать аутбаунд**  
   - Формат: `JSON`  
   - Вставляем ключ от второго сервера  
   - Сохраняем  
4. Настраиваем маршрутизацию:  
   - Раздел **Маршрутизация → Создать правило**  
   - **Network:** `TCP, UDP`  
   - **Outbound Tag:** выбрать наше подключение к европейскому серверу  
   - Сохраняем и **перезапускаем ядро Xray**  

---

## ✅ Проверка работы

1. Подключаемся к клиентскому конфигу от первого VPS (Москва).  
2. Заходим на сайт [2ip.ru](https://2ip.ru) или аналогичный.  
3. Должен отображаться **IP второго (европейского) сервера**.  

---

## 📊 Схема работы

```
Клиент → VPS Москва (yandex.ru:8443) → VPS Европа (google.com:443) → Интернет
```
## 📊 Принцип работы каскадного VPN

                    ┌──────────────────────┐
                    │    Клиенты: ПК,      │
                    │  Телефон, Роутер     │
                    │   (VLESS config)     │
                    └─────────┬────────────┘
                              │
                 Подключение к московскому VPS
                              │
                              ▼
            ┌────────────────────────────────┐
            │   VPS Москва (Российский)      │
            │  - Маскировка: yandex.ru       │
            │  - VLESS порт: 8433            │
            │  - Основной сервер для ключей  │
            │                                │
            │  ┌──────────────┐              │
            │  │  Аутбаунд:   │              │
            │  │  Европейский │<─────────────┘
            │  │  сервер VLESS│
            │  └─────┬────────┘
            │        │
            │        │ TCP/UDP маршрутизация
            │        ▼
            └────────────────────────────────┘
                              │
              Подключение к европейскому серверу
                              ▼
            ┌────────────────────────────────┐
            │   VPS Европа (Германия/        │
            │   Нидерланды/Финляндия)        │
            │  - Маскировка: google.ru       │
            │  - VLESS порт: 443             │
            │  - Ключ VLESS получен с Москвы │
            └────────────────────────────────┘
---

## 🔍 Логика работы с точки зрения провайдера в России

1. Клиент (ПК/телефон) запрашивает `www.example.com`.  
2. Запрос идёт к **московскому VPS** (так как VPN активен).  
3. Для российского провайдера весь трафик **заканчивается на московском сервере**:  
   - Он видит соединение клиента → московский VPS.  
   - Он **не видит**, что реально дальше трафик уходит в Европу.  
   - В логах фиксируется лишь: `подключение к yandex.ru:8433`.  
4. Московский VPS перенаправляет трафик через **VLESS-аутбаунд** в Европу.  
5. Европейский VPS делает реальный запрос к сайту.  
6. Ответ возвращается по цепочке:  
   `example.com → VPS Европа → VPS Москва → клиент`.  
